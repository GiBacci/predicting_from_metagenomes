---
title: "Predicting from Metagenomes"
author: "Giovanni Bacci^1^*  \n^1^Department of Biology, University of Florence, Via Madonna del Piano 6, Sesto Fiorentino, FI, I-50019, Italy  \n*Corresponding author: giovanni.bacci@unifi.it"
output: word_document
bibliography: /home/giovannib/Dropbox/Predicting_from_metagenomes/bib/bibliography.bib
csl: /home/giovannib/Dropbox/Predicting_from_metagenomes/bib/nature.csl
---

```{r setup, include=FALSE}
library(DESeq2)
library(compositions)

library(caret)
library(pROC)

library(tidyverse)
library(ggbeeswarm)

knitr::opts_chunk$set(echo = TRUE, 
                      warning = FALSE,
                      message = FALSE,
                      eval = TRUE)
```

## Running head

Predicting from metagenomes

## Summary (500 characters)


## Keywords


## 1. Introduction


## 2. Materials

### 2.1 Data files

### 2.2 Software requirements

### 2.3 Hardware requirements

## 3. Methods

### 3.1 Importing data

```{r dataInport}
# importing gene counts
genes <- readRDS("./data/gene_counts.rds")

# importing proportion of taxa
taxa <- readRDS("./data/taxa_ab.rds")

# sample data
meta <- readRDS("./data/sample_meta.rds")
```

### 3.2 Data transformation

```{r dataTransformation}
taxa.clr <- clr(taxa)
class(taxa.clr) <- "matrix"

genes.vst <- DESeqDataSetFromMatrix(t(genes), colData = meta, 
                                    design = ~ 1)
genes.vst <- estimateSizeFactors(genes.vst)
genes.vst <- vst(genes.vst)
genes.vst <- t(assay(genes.vst))

alpha <- diversity(taxa, index = "invsimpson")
alpha <- data.frame(A=(alpha - mean(alpha))/sd(alpha))

taxa.pca <- prcomp(taxa.clr, center = T, scale. = T)
genes.pca <- prcomp(genes.vst, center = T, scale. = T)

taxa.x <- taxa.pca$x[,taxa.pca$sdev^2 >= 1]
genes.x <- genes.pca$x[,genes.pca$sdev^2 >= 1]

colnames(taxa.x) <- gsub("PC", "T", colnames(taxa.x))
colnames(genes.x) <- gsub("PC", "F", colnames(genes.x))

y <- meta$genotype
full.data <- cbind(y = y, taxa.x, genes.x, alpha)
full.data <- droplevels(full.data[full.data$y != "other",])
```


## Notes


## References